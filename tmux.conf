# settings
set  -g  utf8
setw -g  utf8          on
set  -g  status-utf8   on
setw -g  xterm-keys    on
setw -g  mode-keys     vi
set  -g  status-keys   "emacs"
set  -g  mouse         on
set  -g  history-limit 5000
set  -g  default-command  "reattach-to-user-namespace -l /bin/bash"
set  -g  default-terminal "screen-256color"

# appearance
set  -g  display-time 2000
set  -g  message-bg            '#e7e7e7'
set  -g  message-fg            '#000000'
set  -g  pane-border-fg        '#909090'
set  -g  pane-active-border-fg '#909090'
set  -g  status-justify left
set  -g  status-left ''
setw -g  window-status-format ' #I #W'
set  -g  status-right-length 50
if '[[ "$THEME" =~ dark ]]' 'set  -g status-bg colour233' \
                            'set  -g status-bg "#ffffff"'
if '[[ "$THEME" =~ dark ]]' 'set  -g status-fg "#565656"' \
                            'set  -g status-fg "#404040"'
if '[[ "$THEME" =~ dark ]]' 'set  -g status-attr dim' \
                            'set  -g status-attr bright'
if '[[ "$THEME" =~ dark ]]' 'setw -g window-status-current-format " #[fg=#ffffff]#I #W#[fg=default]"' \
                            'setw -g window-status-current-format " #[fg=#000000]#I #W#[fg=default]"'
if '[[ "$THEME" =~ dark ]]' "set  -g status-right \" #S #[fg=#9BD4FF]::#[fg=default] #h #[fg=#9BD4FF]::#[fg=default] #(sysctl vm.loadavg | cut -d ' ' -f 3-5) \"" \
                            "set  -g status-right \" #S #[fg=#000000]::#[fg=default] #h #[fg=#000000]::#[fg=default] #(sysctl vm.loadavg | cut -d ' ' -f 3-5) \""

# debugging tmux modes/formats/etc.
# set -g status-right 'mouse_any_flag:#{mouse_any_flag} pane_in_mode:#{pane_in_mode} alt:#{alternate_on}'

# Unbind some defaults
unbind    s              # tree
unbind    t              # time
unbind    x              # kill-pane
unbind   C-b             # prefix
unbind    o              # other-pane
unbind  Space            # next-layout
unbind  -t vi-copy Enter # copy

# prefix
bind   C-a   send-prefix
set    -sg   escape-time 1
set    -g    prefix C-a

# bindings
bind    t    choose-tree
bind    R    refresh-client
bind    r    source-file ~/.tmux.conf \; display "Reloaded!"
bind    K    confirm-before -p "kill-session #S? (y/n)" kill-session
bind    h    set -q status
bind    x    rotate-window
bind   C-x   next-layout
bind   C-n   next-window
bind   C-p   previous-window
bind   C-[   copy-mode
bind  Space  select-pane -t :.+
bind C-Space select-pane -t :.+

# pane manipulation
bind    s    split-window -v
bind    v    split-window -h
bind   C-h   select-pane  -L
bind   C-j   select-pane  -D
bind   C-k   select-pane  -U
bind   C-l   select-pane  -R
bind    o    resize-pane  -Z
bind   C-o   resize-pane  -Z

# copy mode
bind -t vi-copy   v   begin-selection
bind -t vi-copy   y   copy-pipe "reattach-to-user-namespace pbcopy"
bind -t vi-copy Enter copy-pipe "reattach-to-user-namespace pbcopy"
bind -t vi-copy C-WheelUpPane halfpage-up
bind -t vi-copy C-WheelDownPane halfpage-down

# fix scrolling
# This is an attrocious hack that tmux 2.1 forced upon us. Remove it once tmux releases a
# "fixed" version where this is the default.
#
# Bind unprefixed (`-n`) WheelUpPane to check (`if-shell -F`) the state of the pane in
# which the last mouse event occurred (`t=`).
# If it's actively capturing mouse input, or it's in copy-mode, then forward the scroll
# event to the pane.
# Otherwise, enter copy-mode and make sure we can exit it by scrolling back to the bottom
# of the pane (`-e`).
bind -n   WheelUpPane if-shell -Ft= '#{mouse_any_flag}' 'send-keys -M' 'if -Ft= "#{pane_in_mode}" "send-keys -M" "select-pane -t=; copy-mode -e"'
bind -n C-WheelUpPane if-shell -Ft= '#{mouse_any_flag}' 'send-keys -M' 'if -Ft= "#{pane_in_mode}" "send-keys -M" "select-pane -t=; copy-mode -e"'
bind -n   WheelDownPane select-pane -t= \; send-keys -M
bind -n C-WheelDownPane select-pane -t= \; send-keys -M

# quick splits
bind g if-shell 'which gitsh' 'send-keys "glit" Enter' ''
bind T split-window -h "htop"

# fix ssh-agent when tmux is detached
setenv -g SSH_AUTH_SOCK $HOME/.ssh/ssh_auth_sock

